<div id="formulario-orcamento">

  <!--TITULO-->
  <div class="row card">
    <div class="col-md-12">
      <div class="head" style="text-align: center">
        <h3><span class="glyphicon glyphicon-shopping-cart"></span>
          {{orcamento.pedido.codigo ? ('Orçamento código ' + orcamento.pedido.codigo) : ''}}
          {{orcamento.pedido.codigo ? ('criado em ' + (orcamento.pedido.dataPedido | date:'dd/MM/yyyy')) : ''}}
          {{orcamento.pedido.codigo ? '' : 'Novo Orçamento'}}
        </h3>
      </div>
    </div>
    <div class="col-md-12">
      <div class="col-xs-3 col-sm-3">
        <h4>Vendedor</h4>
        <h5 ng-show="orcamento.pedido.vendedor.codigo">{{orcamento.pedido.vendedor.codigo}} - {{orcamento.pedido.vendedor.nome}}</h5>
        <h5 ng-hide="orcamento.pedido.vendedor.codigo">(Nenhum vendedor)</h5>
      </div>
      <div class="col-xs-3 col-sm-3">
        <h4>Produtos</h4>
        <h5>{{orcamento.pedido.items.length}} {{orcamento.pedido.items.length > 1 ? 'Produtos' : 'Produto'}} - Total: {{orcamento.pedido.getValorTotalComDesconto() | currency: 'R$ '}}</h5>
      </div>
      <div class="col-xs-3 col-sm-3">
        <h4>Cliente</h4>
        <h5 ng-show="orcamento.pedido.cliente.codigo">{{orcamento.pedido.cliente.codigo}} - {{orcamento.pedido.cliente.nome}}</h5>
        <h5 ng-hide="orcamento.pedido.cliente.codigo">(Nenhum cliente)</h5>
      </div>
      <div class="col-xs-3 col-sm-3">
        <h4>Pagamento</h4>
        <h5 ng-show="orcamento.pedido.pagamentos.length">
          <span ng-repeat="p in orcamento.pedido.pagamentos">{{p.modalidade.nome}} - {{p.valor | currency: 'R$ '}}<br></span>
        </h5>
        <h5 ng-hide="orcamento.pedido.pagamentos.length">(Nenhuma forma de pagamento)</h5>
      </div>
    </div>
  </div>

  <!--VENDEDOR-->
  <br>
  <div class="row card">
    <div id="form-vendedor" class="col-md-12" ng-init="formularios.vendedor = false" ng-click="formularios.vendedor = !formularios.vendedor; scrollTo($event);">
      <div class="head">
        <h3>Vendedor
          <span ng-if="!formularios.vendedor && orcamento.pedido.vendedor.nome"> &raquo; ({{orcamento.pedido.vendedor.codigo}} - {{orcamento.pedido.vendedor.nome}})</span>
          <a href="" class="limpar" title="Limpar campos" ng-click="orcamento.limparVendedor($event)"><span class="glyphicon glyphicon-erase"></span></a>
          <a href=""><span ng-if="formularios.vendedor" class="glyphicon glyphicon-menu-up"></span></a>
          <a href=""><span ng-if="!formularios.vendedor" class="glyphicon glyphicon-menu-down"></span></a>
        </h3>
      </div>
    </div>
    <div class="col-md-12" uib-collapse="!formularios.vendedor">
      <div class="col-xs-3 col-sm-3">
        <div><h4>Código</h4></div>
        <div class="input-group">
          <input type="text" number-only name="CdVendedor" class="form-control" aria-describedby="basic-addon2" ng-model="cdVendedor" ng-blur="blurCdVendedor()" press-enter="orcamento.buscaVendedorPorCodigo(cdVendedor, true)" press-shift-enter="orcamento.escapeVendedor()">
          <span class="input-group-btn">
            <button class="btn btn-default" tabindex="-1" ng-click="orcamento.buscaVendedorPorCodigo(cdVendedor)"><span class="glyphicon glyphicon-search"></span></button>
          </span>
        </div>
      </div>
      <div class="col-xs-9 col-sm-9">
        <div><h4>Nome</h4></div>
        <div>
          <input type="text" class="form-control" tabindex="-1" ng-value="orcamento.pedido.vendedor.nome" readonly="true">
        </div>
      </div>
    </div>
  </div>

  <!--PRODUTOS-->
  <br>
  <div class="row card">
    <div id="form-produtos" class="col-md-12" ng-init="formularios.produtos = true" ng-click="formularios.produtos = !formularios.produtos; scrollTo($event);">
      <div class="head">
        <h3>Produtos
          <span ng-if="!formularios.produtos && orcamento.pedido.items.length > 0"> &raquo; ({{orcamento.pedido.items.length}} {{orcamento.pedido.items.length > 1 ? 'Produtos' : 'Produto'}} - Total: {{orcamento.pedido.getValorTotalComDesconto() | currency: 'R$ '}})</span>
          <a href="" class="limpar" title="Limpar campos" ng-click="orcamento.limparProdutos($event)"><span class="glyphicon glyphicon-erase"></span></a>
          <a href=""><span ng-if="formularios.produtos" class="glyphicon glyphicon-menu-up"></span></a>
          <a href=""><span ng-if="!formularios.produtos" class="glyphicon glyphicon-menu-down"></span></a>
        </h3>
      </div>
    </div>
    <div class="col-md-12" id="controle-tabela-orcamento" uib-collapse="!formularios.produtos">
      <div class="col-xs-3 col-sm-3">
        <div><h4>Código</h4></div>
        <div class="input-group">
          <input name="CdProduto" type="text" number-only class="form-control" aria-describedby="basic-addon2" ng-model="cdProduto" ng-blur="blurProduto()" ng-readonly="" press-enter="orcamento.buscaProdutoPorCodigo(cdProduto)" press-shift-enter="orcamento.escapeProdutos()" maxlength="6">
          <span class="input-group-btn">
            <button class="btn btn-default" tabindex="-1" ng-click="orcamento.buscaProdutoPorCodigo(cdProduto)"><span class="glyphicon glyphicon-search"></span></button>
          </span>
        </div>
      </div>
      <div class="col-xs-5 col-sm-6">
        <div><h4>Descrição</h4></div>
        <div>
          <input name="NmProduto" type="text" class="form-control" ng-model="nmProduto" ng-readonly="" ng-blur="blurProduto()"
                 press-enter="orcamento.avancar('input', 'quantidade')"
                 press-shift-enter="orcamento.escapeProdutos()"
                 uib-typeahead="produto as produto.NmProduto for produto in orcamento.buscaProdutoPorDescricao($viewValue)"
                 typeahead-template-url="partials/produtosTypeaheadPopup.html"
                 typeahead-min-length="typeahead.min_length"
                 typeahead-loading="isLoading"
                 typeahead-wait-ms="typeahead.wait"
                 typeahead-on-select="orcamento.selectProduto($item)" required>
        </div>
      </div>
      <div class="col-xs-4 col-sm-3">
        <div><h4>Valor unitário</h4></div>
        <div class="input-group">
          <span class="input-group-addon">R$</span>
          <input type="text" class="form-control" readonly="true" tabindex="-1" ng-value="item.produto.preco | currency: ''">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Quantidade</h4></div>
        <div class="input-group">
          <input name="quantidade" type="text" class="form-control" filtro-moeda number-only ng-model="item.quantidade" ng-change="item.setQuantidade(item.quantidade)" press-enter="item.quantidade <= 0 ? orcamento.limparProdutoTemp() : orcamento.addItem()" press-shift-enter="orcamento.escapeProdutos()">
          <span class="input-group-addon">{{item.produto.unidade || '(un)'}}</span>
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Desconto %</h4></div>
        <div class="input-group">
          <input name="percent" type="text" class="form-control" filtro-moeda number-only ng-model="item.descontoPercent" ng-change="item.setDescontoPercent(item.descontoPercent);" press-enter="orcamento.avancar('input', 'dinheiro')" press-shift-enter="orcamento.escapeProdutos()" readonly="true" tabindex="-1">
          <span class="input-group-addon">%</span>
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Desconto R$</h4></div>
        <div class="input-group">
          <span class="input-group-addon">R$</span>
          <input name="dinheiro" type="text" class="form-control" filtro-moeda number-only ng-model="item.descontoDinheiro" ng-change="item.setDescontoDinheiro(item.descontoDinheiro)" press-enter="orcamento.addItem()" press-shift-enter="orcamento.escapeProdutos()" readonly="true" tabindex="-1">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Total</h4></div>
        <div class="input-group">
          <span class="input-group-addon">R$</span>
          <input type="text" class="form-control" readonly="true" tabindex="-1" ng-value="item.getTotalComDesconto() | currency: ''">
        </div>
      </div>
    </div>
    <!--TABELA PRODUTOS-->
    <div class="col-md-12" uib-collapse="!formularios.produtos">
      <div class="">
        <table id="tabela-orcamento" class="table">
          <thead>
            <tr>
              <th valign="middle">Cód</th>
              <th>Descrição</th>
              <th>Un</th>
              <th>Qtd</th>
              <th>Vl unit</th>
              <th>Desc %</th>
              <th>Desc $</th>
              <th>Total</th>
              <th>&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="i in orcamento.pedido.items track by $index">
              <td>{{i.produto.codigo}}</td>
              <td>{{i.produto.nome | limitTo : 50 }}</td>
              <td>{{i.produto.unidade}}</td>
              <td class="editable-elem"><span>{{i.quantidade | currency : ""}}</span><input filtro-moeda number-only type="text" ng-model="i.quantidade"></td>
              <td>{{i.produto.preco | currency}}</td>
              <td class="inactive-editable-elem"><span>{{i.descontoPercent | currency : ""}}%</span><input type="text" filtro-moeda number-only ng-model="i.descontoPercent" ng-change="i.setDescontoPercent(i.descontoPercent)"></td>
              <td class="inactive-editable-elem"><span>{{i.descontoDinheiro | currency : "R$ "}}</span><input type="text" filtro-moeda number-only ng-model="i.descontoDinheiro" ng-change="i.setDescontoDinheiro(i.descontoDinheiro)"></td>
              <td>{{i.getTotalComDesconto() | currency: 'R$ '}}</td>
              <td>
                <a tabindex="-1" ng-click="orcamento.removerItem(i)"><span class="glyphicon glyphicon-trash"></span></a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="col-md-12" uib-collapse="!formularios.produtos">
      <div class="col-md-4">

      </div>
      <div class="col-md-8">
        <div class="col-xs-4 col-sm-4 col-md-4">
          <div><h4>Desconto %</h4></div>
          <div class="div-display">{{(orcamento.pedido.getDescontoPercentTotal() | currency : "")  || "0,00"}}%</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4">
          <div><h4>Desconto R$</h4></div>
          <div class="div-display">{{orcamento.pedido.getDescontoDinheiroTotal() | currency : "R$ "}}</div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4">
          <div><h4>Total do pedido</h4></div>
          <div class="div-display">{{orcamento.pedido.getValorTotalComDesconto() | currency : "R$ "}}</div>
        </div>
      </div>
    </div>
  </div>

  <!--CLIENTE-->
  <br>
  <div class="row card">
    <div id="form-cliente" class="col-md-12" ng-init="formularios.cliente = true" ng-click="formularios.cliente = !formularios.cliente; scrollTo($event);">
      <div class="head">
        <h3>Cliente
          <span ng-if="!formularios.cliente && orcamento.pedido.cliente.nome"> &raquo; ({{cliente.novo ? 'Novo Cliente' : orcamento.pedido.cliente.codigo}} - {{orcamento.pedido.cliente.nome}})</span>
          <a href="" class="limpar" title="Limpar campos" ng-click="orcamento.limparCliente($event)"><span class="glyphicon glyphicon-erase"></span></a>
          <a href=""><span ng-if="formularios.cliente" class="glyphicon glyphicon-menu-up"></span></a>
          <a href=""><span ng-if="!formularios.cliente" class="glyphicon glyphicon-menu-down"></span></a>
        </h3>
      </div>
    </div>
    <div class="col-md-12" uib-collapse="!formularios.cliente">
      <div class="col-xs-3 col-sm-3">
        <div><h4>Código</h4></div>
        <div class="input-group">
          <input type="text" number-only class="form-control" name="CdCliente" aria-describedby="basic-addon2" ng-model="cdCliente" ng-blur="blurCdCliente()" press-enter="orcamento.buscaClientePorCodigo(cdCliente, true)" press-shift-enter="orcamento.salvar()" ng-readonly="cliente.novo" maxlength="6">
          <span class="input-group-btn">
            <button class="btn btn-default" tabindex="-1" ng-click="orcamento.buscaClientePorCodigo(cdCliente)" ng-disabled="cliente.novo"><span class="glyphicon glyphicon-search"></span></button>
            <button class="btn btn-default" tabindex="-1" ng-click="orcamento.novoCliente()" ng-disabled="cliente.novo"><span class="glyphicon glyphicon-plus"></span></button>
          </span>
        </div>
      </div>
      <div class="col-xs-9 col-sm-9">
        <div><h4>Nome <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
        <div>
          <input name="nome-cliente" type="text" class="form-control" ng-model="orcamento.pedido.cliente.nome" ng-readonly="!cliente.novo" press-enter="orcamento.avancar('select', 'tipo')" press-shift-enter="orcamento.salvar()" maxlength="60">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Tipo <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
        <div>
          <select name="tipo" class="form-control" ng-model="orcamento.pedido.cliente.tipo"  ng-disabled="!cliente.novo" press-enter="orcamento.avancar('input', orcamento.pedido.cliente.tipo === 'F' ? 'cpf' : 'cnpj')" press-shift-enter="orcamento.salvar()">
            <option value="F">Pessoa Física</option>
            <option value="J">Pessoa Jurídica</option>
          </select>
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>CPF <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
        <div>
          <input name="cpf" type="text" class="form-control" ng-model="orcamento.pedido.cliente.cpf" ui-mask="999.999.999-99" ng-readonly="!cliente.novo || orcamento.pedido.cliente.tipo !== 'F'" press-enter="orcamento.avancar('input', 'cep')" press-shift-enter="orcamento.salvar()" ng-change="onchangeCPF()">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>CNPJ <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
        <div>
          <input name="cnpj" type="text" class="form-control" ng-model="orcamento.pedido.cliente.cnpj" ui-mask="99.999.999/9999-99" ng-readonly="!cliente.novo  || orcamento.pedido.cliente.tipo !== 'J'" press-enter="orcamento.avancar('input', 'iEstadual')" press-shift-enter="orcamento.salvar()" ng-change="onchangeCNPJ()">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Inscrição Estadual <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
        <div>
          <input name="iEstadual" type="text" class="form-control" ng-model="orcamento.pedido.cliente.iEstadual" ng-readonly="!cliente.novo || orcamento.pedido.cliente.tipo !== 'J'" press-enter="orcamento.avancar('input', 'cep')" press-shift-enter="orcamento.salvar()" maxlength="20">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3" style="padding: 0;">
        <div class="col-sm-8">
          <div><h4>CEP <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
          <div ng-class="cliente.novo ? 'input-group' : ''">
            <input name="cep" type="text" class="form-control" press-enter="cdCEP == orcamento.pedido.cliente.endereco.cep ? orcamento.avancar('input', 'endNumero') : orcamento.buscarCEP()" press-shift-enter="orcamento.salvar()" ng-readonly="!cliente.novo" ng-model="cdCEP" ui-mask="99999-999" ng-blur="blurCdCEP()">
          <span class="input-group-btn" ng-hide="!cliente.novo">
            <button class="btn btn-default" tabindex="-1" ng-click="orcamento.buscarCEP()"><span class="glyphicon glyphicon-search"></span></button>
          </span>
          </div>
        </div>
        <div class="col-sm-4">
          <div><h4>UF</h4></div>
          <div>
            <input type="text" class="form-control" ng-readonly="true" ng-value="orcamento.pedido.cliente.endereco.uf">
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-6" style="padding: 0">
        <div class="col-sm-9">
          <div><h4>Logradouro</h4></div>
          <div>
            <input type="text" class="form-control" ng-readonly="true" ng-value="orcamento.pedido.cliente.endereco.logradouro">
          </div>
        </div>
        <div class="col-sm-3">
          <!--NUMERO-->
          <div><h4>&#8470; <sup>{{cliente.novo ? '1' : ''}}</sup></h4></div>
          <div>
            <input name="endNumero" type="text" class="form-control" ng-readonly="!cliente.novo" ng-model="orcamento.pedido.cliente.endereco.numero" press-enter="orcamento.avancar('input', 'tel-cliente')" press-shift-enter="orcamento.salvar()" maxlength="10">
          </div>
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Bairro</h4></div>
        <div>
          <input type="text" class="form-control" ng-readonly="true" ng-value="orcamento.pedido.cliente.endereco.bairro">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Cidade</h4></div>
        <div>
          <input type="text" class="form-control" ng-readonly="true" ng-value="orcamento.pedido.cliente.endereco.cidade">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Telefone <sup>{{cliente.novo ? '2' : ''}}</sup></h4></div>
        <div class="input-group">
          <span class="input-group-addon">&nbsp;({{orcamento.pedido.cliente.endereco.ddd || 'DDD'}})&nbsp;</span>
          <input name="tel-cliente" type="text" class="form-control" ng-model="orcamento.pedido.cliente.telefone" ui-mask="9999-9999" ng-readonly="!cliente.novo" press-enter="orcamento.avancar('input', 'ddd-cel-cliente')" press-shift-enter="orcamento.salvar()">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div class="col-sm-4">
          <div><h4>DDD </h4></div>
          <input name="ddd-cel-cliente" type="text" class="form-control" ng-model="orcamento.pedido.cliente.dddCelular" ui-mask="(99)" ng-readonly="!cliente.novo" press-enter="orcamento.avancar('input', 'cel-cliente')" press-shift-enter="orcamento.salvar()">
        </div>
        <div class="col-sm-8">
          <div><h4>Celular <sup>{{cliente.novo ? '2' : ''}}</sup></h4></div>
          <input name="cel-cliente" type="text" class="form-control" ng-model="orcamento.pedido.cliente.celular" ui-mask="99999-9999" ng-readonly="!cliente.novo" press-enter="orcamento.avancar('input', 'email-cliente')" press-shift-enter="orcamento.salvar()">
        </div>
      </div>
      <div class="col-xs-3 col-sm-3">
        <div><h4>Email <sup>{{cliente.novo ? '2' : ''}}</sup></h4></div>
        <div>
          <input name="email-cliente" type="text" class="form-control" ng-model="orcamento.pedido.cliente.email" ng-readonly="!cliente.novo" press-enter="" press-shift-enter="orcamento.salvar()" maxlength="50">
        </div>
      </div>


      <div class="col-xs-6 col-sm-6" uib-collapse="!cliente.novo">
        <div><h4></h4></div>
        <div>
          <h5>1 Campo obrigatório</h5>
          <h5>2 Necessário ao menos uma forma de contato</h5>
        </div>
      </div>
      <div class="col-xs-3 col-sm-3" uib-collapse="!cliente.novo">
        <h4>&nbsp;</h4>
        <div>
          <button class="btn btn-default btn-form" ng-click="orcamento.cadastrarCliente()">Cadastrar</button>
        </div>
      </div>
      <div class="col-xs-3 col-sm-3" uib-collapse="!cliente.novo">
        <h4>&nbsp;</h4>
        <div>
          <button class="btn btn-default btn-form" ng-click="cliente.novo = false; orcamento.limparCliente()">Cancelar</button>
        </div>
      </div>

    </div>
  </div>

  <br>
  <div class="row">
    <div class="col-sm-6 col-md-3">
      <button class="btn-orcamento" ng-click="teste()"><span class="glyphicon glyphicon-list-alt"></span> Lista</button>
    </div>
    <div class="col-sm-6 col-md-3">
      <!--<button class="btn-orcamento" ng-click=""><span class="glyphicon glyphicon-trash"></span> Excluir</button>-->
    </div>
    <div class="col-sm-6 col-md-3">
      <button class="btn-orcamento" ng-click="orcamento.salvar()"><span class="glyphicon glyphicon-floppy-disk"></span> Salvar</button>
    </div>
    <div class="col-sm-6 col-md-3">
      <button class="btn-orcamento" ng-click="orcamento.limpar()"><span class="glyphicon glyphicon-erase"></span> Limpar</button>
    </div>
  </div>


</div>
